<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0901-0907標籤業績競賽戰報</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 10px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .statistics-info {
            margin-top: 0px;
            font-size: 1em;
            color: #666;
        }

        .total-amount {
            color: #2196f3;
            font-weight: bold;
        }

        .baseline {
            color: #666;
        }

        .growth-rate {
            font-weight: bold;
        }

        .growth-rate.positive {
            color: #4caf50;
        }

        .growth-rate.negative {
            color: #f44336;
        }

        .update-time {
            background: #e3f2fd;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            color: #1976d2;
            border-bottom: 2px solid #2196f3;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .calendar-icon {
            color: #dc3545;
            font-size: 16px;
        }


        /* 主導航 - 金額積分 vs 客戶數積分 */
        .main-nav {
            display: flex;
            background: #34495e;
            color: white;
            overflow: hidden;
        }
        
        .main-nav-item {
            flex: 1;
            padding: 8px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            background: #34495e;
            color: white;
        }
        
        .main-nav-item:hover {
            background: #2c3e50;
        }
        
        .main-nav-item.active {
            background: #3498db;
            border-bottom: 3px solid #e74c3c;
        }
        
        .main-nav-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 25%;
            height: 50%;
            width: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        /* 子導航 - 組別選擇 */
        .sub-nav {
            background: #34495e;
            border-bottom: 1px solid #2c3e50;
            padding: 0;
        }
        
        /* 標籤組顯示控制 */
        .tab-group {
            display: none;
            gap: 0;
        }
        
        .tab-group.active {
            display: flex;
        }
        
        .group-tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            overflow-x: auto;
        }
        
        .group-tab {
            padding: 12px 18px;
            background: #34495e;
            color: white;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .group-tab span {
            font-weight: normal;
            opacity: 0.9;
            margin-left: 5px;
            font-size: 0.9em;
        }
        
        .group-tab:hover {
            background: #2c3e50;
        }
        
        .group-tab.active {
            background: #3498db;
            border-bottom-color: #e74c3c;
        }
        
        .tab-content {
            display: none;
            padding: 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 12px 6px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border-right: 1px solid #2c3e50;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }
        
        th:hover {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        th.sortable::after {
            content: ' ↕️';
            font-size: 12px;
            margin-left: 5px;
        }
        
        th.sort-asc::after {
            content: ' ↑';
            color: #e74c3c;
            font-weight: bold;
        }
        
        th.sort-desc::after {
            content: ' ↓';
            color: #e74c3c;
            font-weight: bold;
        }
        
        td {
            padding: 10px 6px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
            border-right: 1px solid #ecf0f1;
            font-size: 14px;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e3f2fd;
            transition: all 0.2s ease;
        }
        
        .rank-1, .rank-2, .rank-3 { font-weight: bold; }
        
        .group-a { border-left: 4px solid #2196F3; }
        .group-b { border-left: 4px solid #FF9800; }
        .group-c { border-left: 4px solid #9C27B0; }
        
        .score-excellent { color: #27ae60; font-weight: bold; }
        .score-good { color: #f39c12; font-weight: bold; }
        .score-poor { color: #e74c3c; }
        
        .performance-status {
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
            background: #f8d7da;
            color: #721c24;
        }
        
        .store-name {
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            max-width: 140px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .group-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-left: 3px;
        }
        
        .badge-a { background: #2196F3; }
        .badge-b { background: #FF9800; }
        .badge-c { background: #9C27B0; }
        
        .region-badge {
            display: inline-block;
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-left: 2px;
        }
        
        .region-新創 { background: #e74c3c; }
        .region-營一 { background: #9b59b6; }
        .region-營二 { background: #3498db; }
        .region-營三 { background: #1abc9c; }
        .region-北區 { background: #f39c12; }
        .region-中區 { background: #27ae60; }
        .region-南區 { background: #e67e22; }
        
        .number-cell {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .qualified {
            background: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        
        .threshold-info {
            font-size: 16px;
            color: #6c757d;
            margin-top: 10px;
            padding: 2px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .sort-info {
            font-size: 12px;
            color: #3498db;
            background: #ebf3fd;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
            text-align: center;
        }
        
        /* 自我宣告達成率樣式 */
        .self-declared-rate {
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .performance-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            background-color: #fff3cd;
            color: #856404;
            font-size: 0.9em;
        }
        
        .rate-excellent { background: #d4edda; color: #155724; }
        .rate-good { background: #fff3cd; color: #856404; }
        .rate-poor { background: #f8d7da; color: #721c24; }
        
        /* 中和比例樣式 */
        .zhonghe-ratio {
            font-size: 13px;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .ratio-high { background: #d4edda; color: #155724; }
        .ratio-medium { background: #fff3cd; color: #856404; }
        .ratio-low { background: #f8d7da; color: #721c24; }
        
        .ratio-high::after {
            content: ' ✅';
            margin-left: 4px;
        }

        /* 總計列樣式 */
        .total-row {
            background-color: #f8f9fa !important;
            font-weight: bold;
        }
        
        .total-row td {
            border-top: 2px solid #dee2e6;
        }

        /* 組別統計信息樣式 */
        [id$="-stats"] {
            margin: 5px 0;
            font-size: 0.9em;
            color: #1976d2;
            background-color: #e3f2fd;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        /* 新增達標統計區塊 */
        .achievement-stats {
            background: #fff3e0;
            padding: 15px;
            margin: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }
        
        .achievement-stats h4 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .stat-icon {
            font-size: 16px;
        }
        .qualified::after {
            content: ' ✅';
            margin-left: 4px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            table { font-size: 11px; }
            th, td { padding: 6px 3px; }
            .store-name { max-width: 100px; }
            .group-tab { padding: 10px 15px; font-size: 0.9em; }
            .main-nav { flex-direction: column; }
            .group-tabs { flex-wrap: wrap; }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏆 0901-0907標籤競賽戰報</h1>
        </div>
        
        <!-- 數據更新時間 -->
        <div class="update-time">
            <span class="calendar-icon">📅</span>
            數據更新時間：2024年9月8日
        </div>
        
        <!-- 主導航 - 金額積分 vs 客戶數積分 -->
        <div class="main-nav">
            <button class="main-nav-item active" onclick="switchMainTab('amount')">
                金額積分賽
            </button>
            <button class="main-nav-item" onclick="switchMainTab('customer')">
                客戶數積分賽
            </button>
            <button class="main-nav-item" onclick="switchMainTab('region')">
                區域分析
            </button>
        </div>
        
        <!-- 子導航 - 組別選擇 -->
        <div class="sub-nav">
            <div class="group-tabs">
                <!-- 金額積分時顯示的標籤 -->
                <div id="amount-tabs" class="tab-group active">
                    <button class="group-tab active" onclick="switchGroupTab('group-a')">⭐ A組-新星挑戰組(14家) | 本期金額積分總合：<span id="group-a-amount">載入中...</span></button>
                    <button class="group-tab" onclick="switchGroupTab('group-b')">🚀 B組-飛耀成長組(15家) | 本期金額積分總合：<span id="group-b-amount">載入中...</span></button>
                    <button class="group-tab" onclick="switchGroupTab('group-c')">👑 C組-經典菁英組(15家) | 本期金額積分總合：<span id="group-c-amount">載入中...</span></button>
                </div>
                
                <!-- 客戶數積分時顯示的標籤 -->
                <div id="customer-tabs" class="tab-group">
                    <button class="group-tab active" onclick="switchGroupTab('customer-ab')">⭐🚀 A+B組合併分賽</button>
                    <button class="group-tab" onclick="switchGroupTab('customer-c')">👑 C組分賽</button>
                </div>
                <!-- 區域分析時顯示的標籤 -->
                <div id="region-tabs" class="tab-group">
                    <button class="group-tab active" onclick="switchGroupTab('region-營一')">🏢 營一</button>
                    <button class="group-tab" onclick="switchGroupTab('region-營二')">🏢 營二</button>
                    <button class="group-tab" onclick="switchGroupTab('region-營三')">🏢 營三</button>
                    <button class="group-tab" onclick="switchGroupTab('region-北區')">🌏 北區</button>
                    <button class="group-tab" onclick="switchGroupTab('region-中區')">🌏 中區</button>
                    <button class="group-tab" onclick="switchGroupTab('region-南區')">🌏 南區</button>
                    <button class="group-tab" onclick="switchGroupTab('region-新創')">🚀 新創</button>
                </div>
            </div>
        </div>
        
        <!-- 金額積分內容區 -->
        <div id="amount-content" class="tab-content active">
            <!-- A組分頁 -->
            <div id="group-a" class="tab-content active">
                
                <div class="threshold-info">
                    <div>業績積分門檻 25,000分 | 客戶數積分門檻 60分</div>
                </div>
                <div class="sort-info" id="sort-info-group-a">目前排序：依平均積分排名</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">平均積分排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th>
                            </tr>
                        </thead>
                        <tbody id="group-a-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- B組分頁 -->
            <div id="group-b" class="tab-content">
            
                <div class="threshold-info">
                    <div>業績積分門檻 35,000分 | 客戶數積分門檻 60分</div>
                </div>
                <div class="sort-info" id="sort-info-group-b">目前排序：依平均積分排名</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">平均積分排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th>
                                
                            </tr>
                        </thead>
                        <tbody id="group-b-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="group-c" class="tab-content">
                
                <div class="threshold-info">
                    <div>業績積分門檻 45,000分 | 客戶數積分門檻 30分</div>
                </div>
                <div class="sort-info" id="sort-info-group-c">目前排序：依平均積分排名</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">平均積分排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th>
                                
                            </tr>
                        </thead>
                        <tbody id="group-c-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 客戶數積分內容區 -->
        <div id="customer-content" class="tab-content">
            <div class="threshold-info">
                <strong>👥 客戶數積分競賽：</strong> A+B組合併競賽(客戶數積分門檻：60分) | C組獨立競賽(客戶數積分門檻：30分)<br>
                <strong>📊 積分計算：</strong> 客戶積分 = 舊客數×1 + 新客數×3
            </div>
            
            <!-- A+B組合併分賽 -->
            <div id="customer-ab" class="tab-content active">
                <div class="sort-info">目前排序：依客戶數排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="客戶數排名">客戶數排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th> 
                            </tr>
                        </thead>
                        <tbody id="customer-ab-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- C組獨立分賽 -->
            <div id="customer-c" class="tab-content">
                <div class="sort-info">目前排序：依客戶數排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="客戶數排名">客戶數排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th> 
                            </tr>
                        </thead>
                        <tbody id="customer-c-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- 區域分析內容區 -->
        <div id="region-content" class="tab-content">
            <div class="threshold-info">
                <div class="statistics-info">
                    <span class="total-amount">門市目前加總發印成本：<span id="total-amount"></span></span> | 
                    <span class="baseline">2025上半年月均發印成本：300,909</span> | 
                    <span class="growth-rate">成長率：<span id="growth-rate"></span></span>
                </div>
            </div>
            
            <!-- 營一 -->
            <div id="region-營一" class="tab-content active">
                <div class="sort-info" id="sort-info-region-營一">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>                                   
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-營一-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 營二 -->
            <div id="region-營二" class="tab-content">
                <div class="sort-info" id="sort-info-region-營二">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-營二-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 營三 -->
            <div id="region-營三" class="tab-content">
                <div class="sort-info" id="sort-info-region-營三">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-營三-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 北區 -->
            <div id="region-北區" class="tab-content">
                <div class="sort-info" id="sort-info-region-北區">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-北區-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 中區 -->
            <div id="region-中區" class="tab-content">
                <div class="sort-info" id="sort-info-region-中區">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-中區-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 南區 -->
            <div id="region-南區" class="tab-content">
                <div class="sort-info" id="sort-info-region-南區">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-南區-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 新創 -->
            <div id="region-新創" class="tab-content">
                <div class="sort-info" id="sort-info-region-新創">目前排序：依金額排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="金額排名">金額排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="amountScore">金額積分</th>
                                <th class="sortable" data-field="customerScore">客戶數積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="原始業績">原始業績</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-新創-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 引入外部數據文件 -->
    <script>
        // 當腳本載入完成時的處理函數
        function onScriptsLoaded() {
            if (typeof competitionData !== 'undefined' && typeof augustCompetitionData !== 'undefined') {
                initializePage();
            }
        }

        // 初始化頁面
        function initializePage() {
            currentMainTab = 'amount';
            switchMainTab('amount');
        }
    </script>
    <script src="competition-data.js" onload="onScriptsLoaded()"></script>
    <script src="competition-data-aug.js" onload="onScriptsLoaded()"></script>
    
    <script>
        // 當前活動分頁
        let currentMainTab = 'amount';
        let currentGroupTab = 'group-a';
        let currentSort = { field: null, direction: 'asc' };

        function getRankMedal(rank) {
            switch(rank) {
                case 1: return '🥇';
                case 2: return '🥈';
                case 3: return '🥉';
                default: return rank;
            }
        }

        function getGroupBadge(group) {
            const badges = {
                'A': '<span class="group-badge badge-a">⭐新星</span>',
                'B': '<span class="group-badge badge-b">🚀飛耀</span>',
                'C': '<span class="group-badge badge-c">👑菁英</span>'
            };
            return badges[group] || '';
        }

        function getRegionBadge(region) {
            return `<span class="region-badge region-${region}">${region}</span>`;
        }

        function getZhongheRatioClass(ratio) {
            const numRatio = parseFloat(ratio.replace('%', ''));
            if (numRatio >= 80) return 'ratio-high';
            if (numRatio >= 50) return 'ratio-medium';
            return 'ratio-low';
        }

        function getSelfDeclaredRateClass(rate) {
            const numRate = parseFloat(rate.replace('%', ''));
            if (numRate >= 80) return 'rate-excellent';
            if (numRate >= 50) return 'rate-good';
            return 'rate-poor';
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        // 根據組別判定業績積分是否達標：A>=25000, B>=35000, C>=45000
        function isAmountQualifiedForStore(store) {
            const group = (store.group || '').toString().toUpperCase();
            const thresholds = { 'A': 25000, 'B': 35000, 'C': 45000 };
            const threshold = thresholds[group] || 0;
            const score = Number(store.amountScore) || 0;
            return score >= threshold;
        }

        // 判定任意 score 是否達到該店組別門檻
        function isScoreQualifiedForStore(store, score) {
            const group = (store.group || '').toString().toUpperCase();
            const thresholds = { 'A': 25000, 'B': 35000, 'C': 45000 };
            const threshold = thresholds[group] || 0;
            const s = Number(score) || 0;
            return s >= threshold;
        }

        // 計算每家門市的平均積分並回傳標準競賽排名（同分同名次，下一名次數量減少）
        // 輸入 data 為該組的 store 陣列，回傳物件 map: { storeName: rank }
        function computeAvgRankMap(data) {
            // 建立包含 avg 的暫存陣列
            const arr = data.map(s => {
                const aug = getAugustScore(s.storeName);
                const sept = s.amountScore || 0;
                const avg = (typeof aug === 'number') ? Math.round((aug + sept) / 2) : sept;
                return { storeName: s.storeName, avg };
            });

            // 依 avg 降序排列（分數大排前）
            arr.sort((a, b) => b.avg - a.avg);

            const rankMap = {};
            for (let i = 0; i < arr.length; i++) {
                if (i > 0 && arr[i].avg === arr[i - 1].avg) {
                    // 同分同名次
                    rankMap[arr[i].storeName] = rankMap[arr[i - 1].storeName];
                } else {
                    // 標準競賽排名：排名為索引+1（因此上方三人同列1，下一名為4）
                    rankMap[arr[i].storeName] = i + 1;
                }
            }
            return rankMap;
        }

        function switchMainTab(tab) {
            currentMainTab = tab;
            
            // 更新主導航狀態
            document.querySelectorAll('.main-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 切換內容區域
            document.querySelectorAll('#amount-content, #customer-content, #region-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab + '-content').classList.add('active');
            
            // 切換子導航標籤組
            document.querySelectorAll('.tab-group').forEach(group => {
                group.classList.remove('active');
            });
            document.getElementById(tab + '-tabs').classList.add('active');
            
            // 重置子導航狀態
            if (tab === 'amount') {
                currentGroupTab = 'group-a';
                document.querySelectorAll('#amount-tabs .group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                document.querySelector('#amount-tabs .group-tab[onclick*="group-a"]').classList.add('active');
                
                // 顯示A組內容
                document.querySelectorAll('#amount-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('group-a').classList.add('active');
            } else if (tab === 'customer') {
                currentGroupTab = 'customer-ab';
                document.querySelectorAll('#customer-tabs .group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                document.querySelector('#customer-tabs .group-tab[onclick*="customer-ab"]').classList.add('active');
                
                // 顯示A+B組內容
                document.querySelectorAll('#customer-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('customer-ab').classList.add('active');
            } else if (tab === 'region') {
                currentGroupTab = 'region-營一';
                document.querySelectorAll('#region-tabs .group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                document.querySelector('#region-tabs .group-tab[onclick*="region-營一"]').classList.add('active');
                
                // 顯示營一內容
                document.querySelectorAll('#region-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('region-營一').classList.add('active');
                
            }
            
            // 載入對應數據
            loadTabContent();
        }

        function switchGroupTab(tab) {
            currentGroupTab = tab;
            
            // 更新當前活動標籤組內的標籤狀態
            const activeTabGroup = document.querySelector('.tab-group.active');
            if (activeTabGroup) {
                activeTabGroup.querySelectorAll('.group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                event.target.classList.add('active');
            }
            
            // 在各模式下切換子內容
            if (currentMainTab === 'amount') {
                document.querySelectorAll('#amount-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            } else if (currentMainTab === 'customer') {
                document.querySelectorAll('#customer-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            } else if (currentMainTab === 'region') {
                document.querySelectorAll('#region-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            }
            
            // 載入對應數據
            loadTabContent();
        }

        function loadTabContent() {
            // 重置排序狀態
            currentSort = { field: null, direction: 'asc' };
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            if (currentMainTab === 'amount') {
                if (currentGroupTab.startsWith('group-')) {
                    const group = currentGroupTab.replace('group-', '').toUpperCase();
                    populateGroupTable(group);
                }
            } else if (currentMainTab === 'customer') {
                if (currentGroupTab === 'customer-ab') {
                    populateCustomerABTable();
                } else if (currentGroupTab === 'customer-c') {
                    populateCustomerCTable();
                }
            } else if (currentMainTab === 'region') {
                if (currentGroupTab.startsWith('region-')) {
                    const region = currentGroupTab.replace('region-', '');
                    populateRegionTable(region);
                }
            }
        }

        function populateGroupTable(group) {
            const tbody = document.getElementById(`group-${group.toLowerCase()}-table`);
            if (!tbody) return;
            
            tbody.innerHTML = '';

            const groupData = competitionData.filter(store => store.group === group);
            // 以平均積分排序（預設）並計算排名映射
            const rankMap = computeAvgRankMap(groupData);
            groupData.sort((a, b) => {
                const aAvg = (typeof getAugustScore(a.storeName) === 'number') ? Math.round((getAugustScore(a.storeName) + (a.amountScore || 0)) / 2) : (a.amountScore || 0);
                const bAvg = (typeof getAugustScore(b.storeName) === 'number') ? Math.round((getAugustScore(b.storeName) + (b.amountScore || 0)) / 2) : (b.amountScore || 0);
                return bAvg - aAvg; // 高分在前
            });
            
            groupData.forEach((store) => {
                const isAmountQualified = isAmountQualifiedForStore(store);
                const hasNoPerformance = store.amountScore === 0;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                // 金銀銅牌效果只在預設排序且前三名時顯示
                if ((currentSort.field === null || currentSort.field === '金額排名') && store.金額排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.金額排名}`;
                }
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                // 顯示以平均積分計算的排名（同分同名次，下一名次數量減少）
                const avgRank = rankMap[store.storeName] || store.金額排名;
                const rankDisplay = ((currentSort.field === null || currentSort.field === '金額排名') && avgRank <= 3 && !hasNoPerformance)
                    ? getRankMedal(avgRank)
                    : avgRank;
                
                // 取得八月份積分，計算平均
                const augScore = getAugustScore(store.storeName);
                const augThreshold = store.amountThreshold || store.自我宣告目標 || 0;
                const isAugQualified = (typeof augScore === 'number' && augScore >= augThreshold);
                const augDisplay = (typeof augScore === 'number') ? formatNumber(augScore) : '-';

                const septScore = store.amountScore;
                const isSeptQualified = isAmountQualified;
                const septDisplay = hasNoPerformance ? '<span class="performance-status">尚無積分</span>' : formatNumber(septScore);

                const avgScore = (typeof augScore === 'number') ? Math.round(((augScore || 0) + (septScore || 0)) / 2) : septScore;
                const avgDisplay = typeof avgScore === 'number' ? formatNumber(avgScore) : '-';
                const isAvgQualified = isScoreQualifiedForStore(store, avgScore);

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isAugQualified ? 'qualified' : ''}">${augDisplay}</td>
                    <td class="number-cell ${isSeptQualified ? 'qualified' : ''}">${septDisplay}</td>
                    <td class="number-cell ${isAvgQualified ? 'qualified' : ''}">${avgDisplay}</td>
                    <td class="number-cell">${formatNumber(store.自我宣告目標)}</td>
                    <td class="number-cell">
                        <span class="self-declared-rate ${getSelfDeclaredRateClass(store.自我宣告達成率)}">${store.自我宣告達成率}</span>
                    </td>
                    <td class="number-cell">${formatNumber(store.新客業績)}</td>
                    <td class="number-cell">${formatNumber(store.舊客業績)}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateCustomerABTable() {
            const tbody = document.getElementById('customer-ab-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 篩選A+B組數據
            const abGroupData = competitionData.filter(store => store.group === 'A' || store.group === 'B');
            // 按客戶數排名排序（預設）
            abGroupData.sort((a, b) => a.客戶數排名 - b.客戶數排名);
            
            abGroupData.forEach((store) => {
                const isCustomerQualified = store.客戶數門檻達成率 === 'YES';
                const hasNoPerformance = store.customerScore === 0;

                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                // 金銀銅牌效果只在預設排序且前三名時顯示
                if ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.客戶數排名}`;
                }

                const row = document.createElement('tr'); 
                row.className = rowClass;

                // 始終顯示原始金額排名，不受排序影響
                const rankDisplay = ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) 
                    ? getRankMedal(store.客戶數排名) 
                    : store.客戶數排名;

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${store.customerScore}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateCustomerCTable() {
            const tbody = document.getElementById('customer-c-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 篩選C組數據
            const cGroupData = competitionData.filter(store => store.group === 'C');
            // 按客戶數排名排序（預設）
            cGroupData.sort((a, b) => a.客戶數排名 - b.客戶數排名);
            
            cGroupData.forEach((store) => {
                const isCustomerQualified = store.客戶數門檻達成率 === 'YES';
                const hasNoPerformance = store.customerScore === 0;

                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                // 金銀銅牌效果只在預設排序且前三名時顯示
                if ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.客戶數排名}`;
                }
                
                const row = document.createElement('tr');  
                row.className = rowClass;

                const rankDisplay = ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) 
                    ? getRankMedal(store.客戶數排名) 
                    : store.客戶數排名;

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${store.customerScore}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        function populateRegionTable(region) {
            const tbody = document.getElementById(`region-${region}-table`);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const regionData = competitionData.filter(store => store.region === region);
            // 按金額排名排序（預設）
            regionData.sort((a, b) => a.金額排名 - b.金額排名);
            
            // 初始化總計值
            let totalOriginalAmount = 0;
            let totalNewAmount = 0;
            let totalOldAmount = 0;
            let totalNewCustomers = 0;
            let totalOldCustomers = 0;
            
            regionData.forEach((store) => {
                const isAmountQualified = isAmountQualifiedForStore(store);
                const isCustomerQualified = store.客戶數門檻達成率 === 'YES';
                const hasNoPerformance = store.amountScore === 0;
                
                // 累加總計
                const originalAmount = store.新客業績 + store.舊客業績;
                totalOriginalAmount += originalAmount;
                totalNewAmount += store.新客業績;
                totalOldAmount += store.舊客業績;
                totalNewCustomers += store.新客數;
                totalOldCustomers += store.舊客數;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                row.innerHTML = `
                    <td class="number-cell">${store.金額排名}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td class="number-cell ${isAmountQualified ? 'qualified' : ''}">${formatNumber(store.amountScore)}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${store.customerScore}</td>
                    <td class="number-cell">${formatNumber(store.自我宣告目標)}</td>
                    <td class="number-cell">
                        <span class="self-declared-rate ${getSelfDeclaredRateClass(store.自我宣告達成率)}">${store.自我宣告達成率}</span>
                    </td>
                    <td class="number-cell">${formatNumber(originalAmount)}</td>
                    <td class="number-cell">${formatNumber(store.新客業績)}</td>
                    <td class="number-cell">${formatNumber(store.舊客業績)}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
            
            // 添加總計列
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            const storeCount = regionData.length;
            const avgOriginalAmount = storeCount > 0 ? Math.round(totalOriginalAmount / storeCount) : 0;
            
            totalRow.innerHTML = `
                <td class="number-cell">-</td>
                <td class="store-name">總計 (${storeCount}家)</td>
                <td>-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">
                    ${formatNumber(totalOriginalAmount)}
                    <br>
                    <span style="font-size: 0.85em; color: #666;">
                        平均: ${formatNumber(avgOriginalAmount)}
                    </span>
                </td>
                <td class="number-cell">${formatNumber(totalNewAmount)}</td>
                <td class="number-cell">${formatNumber(totalOldAmount)}</td>
                <td class="number-cell">${totalNewCustomers}</td>
                <td class="number-cell">${totalOldCustomers}</td>
                <td class="number-cell">-</td>
            `;
            tbody.appendChild(totalRow);
        }

        function populateRegionTableWithData(region, data) {
            const tbody = document.getElementById(`region-${region}-table`);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 計算需要加總的欄位
            let totalOriginalAmount = 0;
            let totalNewAmount = 0;
            let totalOldAmount = 0;
            let totalNewCustomers = 0;
            let totalOldCustomers = 0;
            
            // 計算該 data 的平均排名映射（用於排序後的顯示）
            const rankMap = computeAvgRankMap(data);

            data.forEach((store) => {
                const isAmountQualified = isAmountQualifiedForStore(store);
                const isCustomerQualified = store.客戶數門檻達成率 === 'YES';
                const hasNoPerformance = store.amountScore === 0;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                if ((currentSort.field === null || currentSort.field === '金額排名') && store.金額排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.金額排名}`;
                }
                const row = document.createElement('tr');
                row.className = rowClass;
                // 區域分析中的排名顯示
                const rankDisplay = ((currentSort.field === null || currentSort.field === '金額排名') && store.金額排名 <= 3 && !hasNoPerformance) 
                    ? getRankMedal(store.金額排名) 
                    : store.金額排名;

                // 累加總計
                const originalAmount = store.新客業績 + store.舊客業績;
                totalOriginalAmount += originalAmount;
                totalNewAmount += store.新客業績;
                totalOldAmount += store.舊客業績;
                totalNewCustomers += store.新客數;
                totalOldCustomers += store.舊客數;

                row.innerHTML = `
                    <td class="number-cell">${store.金額排名}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td class="number-cell ${isAmountQualified ? 'qualified' : ''}">${formatNumber(store.amountScore)}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${store.customerScore}</td>
                    <td class="number-cell">${formatNumber(store.自我宣告目標)}</td>
                    <td class="number-cell">
                        <span class="self-declared-rate ${getSelfDeclaredRateClass(store.自我宣告達成率)}">${store.自我宣告達成率}</span>
                    </td>
                    <td class="number-cell">${formatNumber(originalAmount)}</td>
                    <td class="number-cell">${formatNumber(store.新客業績)}</td>
                    <td class="number-cell">${formatNumber(store.舊客業績)}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 初始化排序功能
        function initializeSorting() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('sortable')) {
                    const field = e.target.getAttribute('data-field');
                    sortTable(field, e.target);
                }
            });
        }

        // 排序表格
        function sortTable(field, headerElement) {
            // 更新排序方向
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.direction = 'asc';
                currentSort.field = field;
            }

            // 更新表頭樣式
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            headerElement.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');

            // 獲取當前顯示的數據
            let currentData = [];
            if (currentMainTab === 'amount') {
                const group = currentGroupTab.replace('group-', '').toUpperCase();
                currentData = competitionData.filter(store => store.group === group);
            } else if (currentMainTab === 'customer') {
                if (currentGroupTab === 'customer-ab') {
                    currentData = competitionData.filter(store => store.group === 'A' || store.group === 'B');
                } else if (currentGroupTab === 'customer-c') {
                    currentData = competitionData.filter(store => store.group === 'C');
                }
            } else if (currentMainTab === 'region') {
                const region = currentGroupTab.replace('region-', '');
                currentData = competitionData.filter(store => store.region === region);
            }

            // 排序數據
            currentData.sort((a, b) => {
                let valueA, valueB;

                switch(field) {
                    case 'storeName':
                        valueA = a.storeName;
                        valueB = b.storeName;
                        break;
                    case 'region':
                        valueA = a.region;
                        valueB = b.region;
                        break;
                    case 'amountScore':
                        valueA = a.amountScore;
                        valueB = b.amountScore;
                        break;
                    case 'group':
                        valueA = a.group;
                        valueB = b.group;
                        break;
                    case 'customerScore':
                        valueA = a.customerScore;
                        valueB = b.customerScore;
                        break;
                    case '金額排名':
                        valueA = a.金額排名;
                        valueB = b.金額排名;
                        break;
                    case '客戶數排名':
                        valueA = a.客戶數排名;
                        valueB = b.客戶數排名;
                        break;
                    case '原始業績':
                        valueA = a.新客業績 + a.舊客業績;
                        valueB = b.新客業績 + b.舊客業績;
                        break;
                    case '新客業績':
                        valueA = a.新客業績;
                        valueB = b.新客業績;
                        break;
                    case '自我宣告目標':
                        valueA = a.自我宣告目標;
                        valueB = b.自我宣告目標;
                        break;
                    case '自我宣告達成率':
                        valueA = parseFloat(a.自我宣告達成率.replace('%', ''));
                        valueB = parseFloat(b.自我宣告達成率.replace('%', ''));
                        break;
                    case '舊客業績':
                        valueA = a.舊客業績;
                        valueB = b.舊客業績;
                        break;
                    case '新客數':
                        valueA = a.新客數;
                        valueB = b.新客數;
                        break;
                    case '舊客數':
                        valueA = a.舊客數;
                        valueB = b.舊客數;
                        break;
                    case '中和比例':
                        valueA = parseFloat(a.中和比例.replace('%', ''));
                        valueB = parseFloat(b.中和比例.replace('%', ''));
                        break;
                    case 'augustScore':
                        // 直接獲取8月份的金額積分
                        const augustStoreA = augustCompetitionData.find(store => store.storeName === a.storeName);
                        const augustStoreB = augustCompetitionData.find(store => store.storeName === b.storeName);
                        valueA = augustStoreA ? augustStoreA.amountScore : -1;
                        valueB = augustStoreB ? augustStoreB.amountScore : -1;
                        break;
                    case 'avgScore':
                        // 平均：若有8月數據則取(8月 + 9月)/2，否則只用9月
                        const aAug = (augustCompetitionData.find(s => s.storeName === a.storeName) || {}).amountScore;
                        const bAug = (augustCompetitionData.find(s => s.storeName === b.storeName) || {}).amountScore;
                        const aSept = a.amountScore || 0;
                        const bSept = b.amountScore || 0;
                        valueA = (typeof aAug === 'number') ? Math.round((aAug + aSept) / 2) : aSept;
                        valueB = (typeof bAug === 'number') ? Math.round((bAug + bSept) / 2) : bSept;
                        break;
                    default:
                        return 0;
                }

                // 比較邏輯
                if (typeof valueA === 'string') {
                    return currentSort.direction === 'asc' 
                        ? valueA.localeCompare(valueB)
                        : valueB.localeCompare(valueA);
                } else {
                    return currentSort.direction === 'asc' 
                        ? valueA - valueB
                        : valueB - valueA;
                }
            });

            // 重新填充表格
            if (currentMainTab === 'amount') {
                const group = currentGroupTab.replace('group-', '').toUpperCase();
                populateGroupTableWithData(group, currentData);
            } else if (currentMainTab === 'customer') {
                if (currentGroupTab === 'customer-ab') {
                    populateCustomerABTableWithData(currentData);
                } else if (currentGroupTab === 'customer-c') {
                    populateCustomerCTableWithData(currentData);
                }
            } else if (currentMainTab === 'region') {
                const region = currentGroupTab.replace('region-', '');
                populateRegionTableWithData(region, currentData);
            }

            // 更新排序資訊
            updateSortInfo(field);
        }

        // 使用指定數據填充組別表格
        function populateGroupTableWithData(group, data) {
            const tbody = document.getElementById(`group-${group.toLowerCase()}-table`);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 計算該 data 的平均排名映射（用於排序後的顯示）
            const rankMap = computeAvgRankMap(data);
            
            data.forEach((store) => {
                const isAmountQualified = isAmountQualifiedForStore(store);
                const hasNoPerformance = store.amountScore === 0;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                // 金銀銅牌效果只在預設排序且前三名時顯示
                if ((currentSort.field === null || currentSort.field === '金額排名') && store.金額排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.金額排名}`;
                }
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                // 顯示以平均積分計算的排名（同分同名次，下一名次數量減少）
                const avgRank = rankMap[store.storeName] || store.金額排名;
                const rankDisplay = ((currentSort.field === null || currentSort.field === '金額排名') && avgRank <= 3 && !hasNoPerformance)
                    ? getRankMedal(avgRank)
                    : avgRank;
                
                // 取得八月份積分，計算平均
                const augScore = getAugustScore(store.storeName);
                const isAugQualified = isAmountQualified;
                const augDisplay = (typeof augScore === 'number') ? formatNumber(augScore) : '-';

                const septScore = store.amountScore;
                const isSeptQualified = isAmountQualified;
                const septDisplay = formatNumber(septScore);

                const avgScore = (typeof augScore === 'number') ? Math.round(((augScore || 0) + (septScore || 0)) / 2) : septScore;
                const avgDisplay = typeof avgScore === 'number' ? formatNumber(avgScore) : '-';
                const isAvgQualified = isScoreQualifiedForStore(store, avgScore);

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isAugQualified ? 'qualified' : ''}">${augDisplay}</td>
                    <td class="number-cell ${isSeptQualified ? 'qualified' : ''}">${septDisplay}</td>
                    <td class="number-cell ${isAvgQualified ? 'qualified' : ''}">${avgDisplay}</td>
                    <td class="number-cell">${formatNumber(store.自我宣告目標)}</td>
                    <td class="number-cell">
                        <span class="self-declared-rate ${getSelfDeclaredRateClass(store.自我宣告達成率)}">${store.自我宣告達成率}</span>
                    </td>
                    <td class="number-cell">${formatNumber(store.新客業績)}</td>
                    <td class="number-cell">${formatNumber(store.舊客業績)}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 使用指定數據填充客戶A+B表格
        function populateCustomerABTableWithData(data) {
            const tbody = document.getElementById('customer-ab-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            data.forEach((store, index) => {
                const isCustomerQualified = store.客戶數門檻達成率 === 'YES';
                const hasNoPerformance = store.customerScore === 0;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                // 金銀銅牌效果只在預設排序且前三名時顯示
                if ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.客戶數排名}`;
                }
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                // 始終顯示原始客戶數排名，不受排序影響
                const rankDisplay = ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) 
                    ? getRankMedal(store.客戶數排名) 
                    : store.客戶數排名;
                
                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${store.customerScore}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>

                `;
                tbody.appendChild(row);
            });
        }

        // 使用指定數據填充客戶C組表格
        function populateCustomerCTableWithData(data) {
            const tbody = document.getElementById('customer-c-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            data.forEach((store, index) => {
                const isCustomerQualified = store.客戶數門檻達成率 === 'YES';
                const hasNoPerformance = store.customerScore === 0;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                // 金銀銅牌效果只在預設排序且前三名時顯示
                if ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) {
                    rowClass += ` rank-${store.客戶數排名}`;
                }
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                // 始終顯示原始客戶數排名，不受排序影響
                const rankDisplay = ((currentSort.field === null || currentSort.field === '客戶數排名') && store.客戶數排名 <= 3 && !hasNoPerformance) 
                    ? getRankMedal(store.客戶數排名) 
                    : store.客戶數排名;
                
                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${store.customerScore}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });

            // 添加總計列
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td class="number-cell">-</td>
                <td class="store-name">總計</td>
                <td>-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">${formatNumber(totalOriginalAmount)}</td>
                <td class="number-cell">${formatNumber(totalNewAmount)}</td>
                <td class="number-cell">${formatNumber(totalOldAmount)}</td>
                <td class="number-cell">${totalNewCustomers}</td>
                <td class="number-cell">${totalOldCustomers}</td>
                <td class="number-cell">-</td>
            `;
            tbody.appendChild(totalRow);
        }

        // 更新排序資訊
        function updateSortInfo(field) {
            const fieldNames = {
                'storeName': '門市名稱',
                'region': '區域',
                'group': '組別',
                'amountScore': '9月金額積分',
                'augustScore': '8月金額積分',
                'avgScore': '平均積分',
                'customerScore': '客戶數積分',
                '新客業績': '新客業績',
                '舊客業績': '舊客業績',
                '自我宣告目標': '自我宣告目標',
                '自我宣告達成率': '自我宣告達成率',
                '新客數': '新客數',
                '舊客數': '舊客數',
                '中和比例': '中和發包比例',
                '金額排名': '金額排名',
                '客戶數排名': '客戶數排名',
                '原始業績': '原始業績'

            };
            
            const direction = currentSort.direction === 'asc' ? '升序' : '降序';
            const sortInfo = document.getElementById(`sort-info-${currentGroupTab}`);
            
            if (sortInfo) {
                sortInfo.textContent = `目前排序：依${fieldNames[field]} (${direction})`;
            }
        }

        // 更新組別統計資訊
        function updateGroupStats() {
            // 計算各組的金額積分總和
            const groups = ['A', 'B', 'C'];
            groups.forEach(group => {
                const groupData = competitionData.filter(store => store.group === group);
                const totalAmount = groupData.reduce((sum, store) => sum + store.amountScore, 0);
                // 更新組別標籤中的金額總和
                const amountElement = document.getElementById(`group-${group.toLowerCase()}-amount`);
                if (amountElement) {
                    amountElement.textContent = formatNumber(totalAmount);
                }
                // 隱藏原有的統計區塊
                const statsElement = document.getElementById(`group-${group.toLowerCase()}-stats`);
                if (statsElement) {
                    statsElement.style.display = 'none';
                }
            });
        }

        // 更新統計資訊
        function updateStatisticsInfo() {
            const totalAmount = document.getElementById('total-amount');
            const growthRate = document.getElementById('growth-rate');
            
            if (totalAmount && growthRate && window.competitionStatistics) {
                totalAmount.textContent = formatNumber(window.competitionStatistics.原始總業績加總);
                const growth = ((window.competitionStatistics.原始總業績加總 - 300909) / 300909 * 100).toFixed(1);
                growthRate.textContent = `${growth}%`;
                growthRate.parentElement.classList.add(growth >= 0 ? 'positive' : 'negative');
            }
        }

        // 獲取8月份的金額積分
        function getAugustScore(storeName) {
            try {
                if (typeof augustCompetitionData === 'undefined') {
                    console.error('augustCompetitionData is undefined');
                    return '-';
                }
                if (!Array.isArray(augustCompetitionData)) {
                    console.error('augustCompetitionData is not an array:', augustCompetitionData);
                    return '-';
                }
                console.log('Looking for store:', storeName, 'in', augustCompetitionData.length, 'stores');
                const augustStore = augustCompetitionData.find(store => store.storeName === storeName);
                if (!augustStore) {
                    console.log('Store not found:', storeName);
                    return '-';
                }
                const score = augustStore.amountScore;
                console.log('Found score:', score, 'for store:', storeName);
                return score;
            } catch (error) {
                console.error('Error in getAugustScore:', error);
                return '-';
            }
        }

        // 初始化頁面（在 DOMContentLoaded 後執行）
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ready — initializing page');

            // 基本檢查：確保資料檔已由<script>載入
            const missing = [];
            if (typeof competitionData === 'undefined') missing.push('competition-data.js');
            if (typeof augustCompetitionData === 'undefined') missing.push('competition-data-aug.js');

            if (missing.length) {
                console.error('Missing data files:', missing.join(', '));
                document.querySelector('.container').innerHTML = `
                    <div style="padding: 50px; text-align: center; color: #e74c3c;">
                        <h2>❌ 數據載入失敗</h2>
                        <p>缺少下列資料檔：${missing.join(', ')}</p>
                        <p>請確認這些檔案與 HTML 位於同一目錄，並正確載入。</p>
                    </div>
                `;
                return;
            }

            // 一切正常：載入初始畫面與功能
            try {
                loadTabContent();
                initializeSorting();
                updateStatisticsInfo();
                updateGroupStats();
            } catch (err) {
                console.error('Error during initialization:', err);
                document.querySelector('.container').innerHTML = `
                    <div style="padding: 50px; text-align: center; color: #e74c3c;">
                        <h2>❌ 初始化失敗</h2>
                        <pre style="text-align:left; max-width:800px; margin:0 auto;">${err}</pre>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
                    