<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0901-0921標籤業績競賽戰報</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #d3d3d3 0%, #797979 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: #00548b;
            color: white;
            padding: 5px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
        }
        
        .statistics-info {
            margin-top: 0px;
            font-size: 1em;
            color: #666;
        }

        .total-amount {
            color: #2196f3;
            font-weight: bold;
        }

        .baseline {
            color: #666;
        }

        .growth-rate {
            font-weight: bold;
        }

        .growth-rate.positive {
            color: #4caf50;
        }

        .growth-rate.negative {
            color: #f44336;
        }

        .update-time {
            background: #e3f2fd;
            padding: 5px;
            text-align: center;
            font-weight: bold;
            color: #1976d2;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .calendar-icon {
            color: #dc3545;
            font-size: 16px;
        }


        /* 主導航 - 金額積分 vs 客戶數積分 */
        .main-nav {
            display: flex;
            background: #595959;
            color: white;
            overflow: hidden;
        }
        
        .main-nav-item {
            flex: 1;
            padding: 4px 20px;
            background: #585858;
            color: white;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .main-nav-item:hover {
            background: #323232;
        }
        
        .main-nav-item.active {
            background: #909090;
            border-bottom: 3px solid #ffdd00;
        }
        
        .main-nav-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 25%;
            height: 50%;
            width: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        /* 子導航 - 組別選擇 */
        .sub-nav {
            background: #979797;
            padding: 0;
        }
        
        /* 標籤組顯示控制 */
        .tab-group {
            display: none;
            gap: 0;
        }
        
        .tab-group.active {
            display: flex;
        }
        
        .group-tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            overflow-x: auto;
        }
        
        .group-tab {
            padding: 4px 20px;
            background: #979797;
            color: white;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .group-tab span {
            font-weight: normal;
            opacity: 0.9;
            margin-left: 5px;
            font-size: 0.9em;
        }
        
        .group-tab:hover {
            background: #2c3e50;
        }
        
        .group-tab.active {
            background: #3498db;
            border-bottom-color: #ffdd00;
        }
        
        .tab-content {
            display: none;
            padding: 0;
        }

        /* 統計儀表版樣式 */
        .dashboard {
            padding: 20px;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .kpi-card {
            background: #ffffff;
            border: 1px solid #818181;
            border-radius: 10px;
            padding: 14px 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .kpi-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 6px;
        }
        .kpi-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #333;
        }
        .kpi-sub {
            font-size: 0.85em;
            color: #888;
            margin-top: 4px;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .chart-placeholder {
            background: #fafafa;
            border: 1px dashed #ccc;
            border-radius: 10px;
            min-height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 680px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 12px 6px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border-right: 1px solid #2c3e50;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }
        
        th:hover {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        th.sortable::after {
            content: ' ↕️';
            font-size: 12px;
            margin-left: 5px;
        }
        
        th.sort-asc::after {
            content: ' ↑';
            color: #e74c3c;
            font-weight: bold;
        }
        
        th.sort-desc::after {
            content: ' ↓';
            color: #e74c3c;
            font-weight: bold;
        }
        
        td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
            border-right: 1px solid #ecf0f1;
            font-size: 14px;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e3f2fd;
            transition: all 0.2s ease;
        }
        
        .group-a { border-left: 4px solid #2196F3; }
        .group-b { border-left: 4px solid #FF9800; }
        .group-c { border-left: 4px solid #9C27B0; }
        
        .score-excellent { color: #27ae60; font-weight: bold; }
        .score-good { color: #f39c12; font-weight: bold; }
        .score-poor { color: #e74c3c; }
        
        .performance-status {
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
            background: #f8d7da;
            color: #721c24;
        }
        
        .store-name {
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            max-width: 140px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .group-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-left: 3px;
        }
        
        .badge-a { background: #2196F3; }
        .badge-b { background: #FF9800; }
        .badge-c { background: #9C27B0; }
        
        .region-badge {
            display: inline-block;
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-left: 2px;
        }
        
        .region-新創 { background: #e74c3c; }
        .region-營一 { background: #9b59b6; }
        .region-營二 { background: #3498db; }
        .region-營三 { background: #1abc9c; }
        .region-北區 { background: #f39c12; }
        .region-中區 { background: #27ae60; }
        .region-南區 { background: #e67e22; }
        
        .number-cell {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .qualified {
            background: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        
        .threshold-info {
            font-size: 16px;
            color: #6c757d;
            margin-top: 10px;
            padding: 2px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .sort-info {
            font-size: 12px;
            color: #3498db;
            background: #ebf3fd;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
            text-align: center;
        }
        
        /* 自我宣告達成率樣式 */
        .self-declared-rate {
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .performance-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            background-color: #fff3cd;
            color: #856404;
            font-size: 0.9em;
        }
        
        .rate-excellent { background: #d4edda; color: #155724; }
        .rate-good { background: #fff3cd; color: #856404; }
        .rate-poor { background: #f8d7da; color: #721c24; }
        
        /* 中和比例樣式 */
        .zhonghe-ratio {
            font-size: 13px;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .ratio-high { background: #d4edda; color: #155724; }
        .ratio-medium { background: #fff3cd; color: #856404; }
        .ratio-low { background: #f8d7da; color: #721c24; }
        
        .ratio-high::after {
            content: ' ✅';
            margin-left: 4px;
        }

        /* 總計列樣式 */
        .total-row {
            background-color: #f8f9fa !important;
            font-weight: bold;
        }
        
        .total-row td {
            border-top: 2px solid #dee2e6;
        }

        /* 組別統計信息樣式 */
        [id$="-stats"] {
            margin: 5px 0;
            font-size: 0.9em;
            color: #1976d2;
            background-color: #e3f2fd;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        /* 新增達標統計區塊 */
        .achievement-stats {
            background: #fff3e0;
            padding: 15px;
            margin: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }
        
        .achievement-stats h4 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .stat-icon {
            font-size: 16px;
        }
        .qualified::after {
            content: ' ✅';
            margin-left: 4px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            table { font-size: 11px; }
            th, td { padding: 6px 3px; }
            .store-name { max-width: 100px; }
            .group-tab { padding: 10px 15px; font-size: 0.9em; }
            .main-nav { flex-direction: column; }
            .group-tabs { flex-wrap: wrap; }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏆 0901-0921標籤競賽戰報</h1>
        </div>
        
        <!-- 數據更新時間 -->
        <div class="update-time">
            <span class="calendar-icon">📅</span>
            數據更新時間：2024年9月22日
        </div>
        
        <!-- 主導航 - 金額積分 vs 客戶數積分 -->
        <div class="main-nav">
            <button class="main-nav-item active" onclick="switchMainTab('amount')">
                金額積分賽
            </button>
            <button class="main-nav-item" onclick="switchMainTab('customer')">
                客戶數積分賽
            </button>
            <button class="main-nav-item" onclick="switchMainTab('region')">
                區域分析
            </button>
            <button class="main-nav-item" onclick="switchMainTab('statistics')">
                統計儀表版
            </button>
        </div>
        
        <!-- 子導航 - 組別選擇 -->
        <div class="sub-nav">
            <div class="group-tabs">
                <!-- 金額積分時顯示的標籤 -->
                <div id="amount-tabs" class="tab-group active">
                    <button class="group-tab active" onclick="switchGroupTab('group-a')">⭐ A組-新星挑戰組(門檻:25000) | 本期金額積分總合：<span id="group-a-amount">載入中...</span></button>
                    <button class="group-tab" onclick="switchGroupTab('group-b')">🚀 B組-飛耀成長組(門檻：35000) | 本期金額積分總合：<span id="group-b-amount">載入中...</span></button>
                    <button class="group-tab" onclick="switchGroupTab('group-c')">👑 C組-經典菁英組(門檻：45000) | 本期金額積分總合：<span id="group-c-amount">載入中...</span></button>
                </div>
                
                <!-- 客戶數積分時顯示的標籤 -->
                <div id="customer-tabs" class="tab-group">
                    <button class="group-tab active" onclick="switchGroupTab('customer-ab')">⭐🚀 A+B組合併分賽(積分門檻:60分)</button>
                    <button class="group-tab" onclick="switchGroupTab('customer-c')">👑 C組分賽(積分門檻30分)</button>
                </div>
                <!-- 區域分析時顯示的標籤 -->
                <div id="region-tabs" class="tab-group">
                    <button class="group-tab active" onclick="switchGroupTab('region-營一')">🏢 營一</button>
                    <button class="group-tab" onclick="switchGroupTab('region-營二')">🏢 營二</button>
                    <button class="group-tab" onclick="switchGroupTab('region-營三')">🏢 營三</button>
                    <button class="group-tab" onclick="switchGroupTab('region-北區')">🌏 北區</button>
                    <button class="group-tab" onclick="switchGroupTab('region-中區')">🌏 中區</button>
                    <button class="group-tab" onclick="switchGroupTab('region-南區')">🌏 南區</button>
                    <button class="group-tab" onclick="switchGroupTab('region-新創')">🚀 新創</button>
                </div>

                <!-- 統計儀表版時顯示的標籤（預留，暫無子標籤） -->
                <div id="statistics-tabs" class="tab-group">
                </div>
            </div>
        </div>
        
        <!-- 金額積分內容區 -->
        <div id="amount-content" class="tab-content active">
            <!-- A組分頁 -->
            <div id="group-a" class="tab-content active">
                <div class="sort-info" id="sort-info-group-a">目前排序：依平均積分排名</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="avgRank">平均積分排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th>
                            </tr>
                        </thead>
                        <tbody id="group-a-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- B組分頁 -->
            <div id="group-b" class="tab-content">
                <div class="sort-info" id="sort-info-group-b">目前排序：依平均積分排名</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="avgRank">平均積分排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th>
                                
                            </tr>
                        </thead>
                        <tbody id="group-b-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="group-c" class="tab-content">
                <div class="sort-info" id="sort-info-group-c">目前排序：依平均積分排名</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="avgRank">平均積分排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均積分</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="新客業績">新客業績</th>
                                <th class="sortable" data-field="舊客業績">舊客業績</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th>
                                
                            </tr>
                        </thead>
                        <tbody id="group-c-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 客戶數積分內容區 -->
        <div id="customer-content" class="tab-content">            
            <!-- A+B組合併分賽 -->
            <div id="customer-ab" class="tab-content active">
                <div class="sort-info">目前排序：依平均客戶數排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="customerAvgRank">客戶數積分平均排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th> 
                            </tr>
                        </thead>
                        <tbody id="customer-ab-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- C組獨立分賽 -->
            <div id="customer-c" class="tab-content">
                <div class="sort-info">目前排序：依平均客戶數排名 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="customerAvgRank">客戶數積分平均排名</th>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="region">區域</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="新客數">新客數</th>
                                <th class="sortable" data-field="舊客數">舊客數</th>
                                <th class="sortable" data-field="中和比例">中和發包比例</th> 
                            </tr>
                        </thead>
                        <tbody id="customer-c-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- 區域分析內容區 -->
        <div id="region-content" class="tab-content">
            <!-- 營一 -->
            <div id="region-營一" class="tab-content active">
                <div class="sort-info" id="sort-info-region-營一">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-營一-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 營二 -->
            <div id="region-營二" class="tab-content">
                <div class="sort-info" id="sort-info-region-營二">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-營二-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 營三 -->
            <div id="region-營三" class="tab-content">
                <div class="sort-info" id="sort-info-region-營三">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-營三-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 北區 -->
            <div id="region-北區" class="tab-content">
                <div class="sort-info" id="sort-info-region-北區">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-北區-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 中區 -->
            <div id="region-中區" class="tab-content">
                <div class="sort-info" id="sort-info-region-中區">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-中區-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 南區 -->
            <div id="region-南區" class="tab-content">
                <div class="sort-info" id="sort-info-region-南區">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-南區-table">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 新創 -->
            <div id="region-新創" class="tab-content">
                <div class="sort-info" id="sort-info-region-新創">目前排序：依門市名稱 (固定)</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-field="storeName">門市名稱</th>
                                <th class="sortable" data-field="group">組別</th>
                                <th class="sortable" data-field="augustScore">8月金額積分</th>
                                <th class="sortable" data-field="amountScore">9月金額積分</th>
                                <th class="sortable" data-field="avgScore">平均金額積分</th>
                                <th class="sortable" data-field="augustCustomerScore">8月客戶數積分</th>
                                <th class="sortable" data-field="customerScore">9月客戶數積分</th>
                                <th class="sortable" data-field="averageCustomerScore">平均客戶數積分</th>
                                <th class="sortable" data-field="august原始業績">8月原始業績</th>
                                <th class="sortable" data-field="sept原始業績">9月原始業績</th>
                                <th class="sortable" data-field="自我宣告目標">自我宣告目標</th>
                                <th class="sortable" data-field="自我宣告達成率">自我宣告達成率</th>
                                <th class="sortable" data-field="中和比例">中和發包比率</th>
                            </tr>
                        </thead>
                        <tbody id="region-新創-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 統計儀表版內容區（預留） -->
        <div id="statistics-content" class="tab-content">
            <div class="dashboard">
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-title">8月原始業績合計</div>
                        <div class="kpi-value" id="kpi-aug-sum">—</div>
                        <div class="kpi-sub">平均：<span id="kpi-aug-avg">—</span></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">8月原始業績達成率</div>
                        <div class="kpi-value" id="kpi-aug-achievement-rate">—</div>
                        <div class="kpi-sub">基準：300,909</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">8月新客數/舊客數</div>
                        <div class="kpi-value"><span id="kpi-aug-new-count">—</span> / <span id="kpi-aug-old-count">—</span></div>
                        <div class="kpi-sub">新客數 / 舊客數 合計</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">8月新客/舊客原始業績</div>
                        <div class="kpi-value"><span id="kpi-aug-new-rev">—</span> / <span id="kpi-aug-old-rev">—</span></div>
                        <div class="kpi-sub">新客原始 / 舊客原始 業績合計</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">8月新客/舊客客單價</div>
                        <div class="kpi-value"><span id="kpi-aug-new-arpu">—</span> / <span id="kpi-aug-old-arpu">—</span></div>
                        <div class="kpi-sub">新客客單/舊客客單</div>
                    </div>
                </div>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-title">9月原始業績合計</div>
                        <div class="kpi-value" id="kpi-sept-sum">—</div>
                        <div class="kpi-sub">平均：<span id="kpi-sept-avg">—</span></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">9月原始業績達成率</div>
                        <div class="kpi-value" id="kpi-sept-achievement-rate">—</div>
                        <div class="kpi-sub">基準：300,909</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">9月新客數/舊客數</div>
                        <div class="kpi-value"><span id="kpi-sept-new-count">—</span> / <span id="kpi-sept-old-count">—</span></div>
                        <div class="kpi-sub">新客數 / 舊客數 合計</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">9月新客/舊客原始業績</div>
                        <div class="kpi-value"><span id="kpi-sept-new-rev">—</span> / <span id="kpi-sept-old-rev">—</span></div>
                        <div class="kpi-sub">新客原始 / 舊客原始 業績合計</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">9月新客/舊客客單價</div>
                        <div class="kpi-value"><span id="kpi-sept-new-arpu">—</span> / <span id="kpi-sept-old-arpu">—</span></div>
                        <div class="kpi-sub">新客客單/舊客客單</div>
                    </div>
                </div>
                <!--
                //<div class="chart-grid">
                    <div class="chart-placeholder">圖表區塊（待補）</div>
                    <div class="chart-placeholder">圖表區塊（待補）</div>
                </div>
                -->
            </div>
        </div>
    </div>
    
    <!-- 引入外部數據文件 -->
    <script>
        // 當腳本載入完成時的處理函數
        function onScriptsLoaded() {
            if (typeof competitionData !== 'undefined' && typeof augustCompetitionData !== 'undefined') {
                initializePage();
            }
        }

        // 初始化頁面
        function initializePage() {
            currentMainTab = 'amount';
            switchMainTab('amount');
        }
    </script>
    <script src="competition-data.js" onload="onScriptsLoaded()"></script>
    <script src="competition-data-aug.js" onload="onScriptsLoaded()"></script>
    
    <script>
        // 當前活動分頁
        let currentMainTab = 'amount';
        let currentGroupTab = 'group-a';
        let currentSort = { field: null, direction: 'asc' };

        function getGroupBadge(group) {
            const badges = {
                'A': '<span class="group-badge badge-a">⭐新星</span>',
                'B': '<span class="group-badge badge-b">🚀飛耀</span>',
                'C': '<span class="group-badge badge-c">👑菁英</span>'
            };
            return badges[group] || '';
        }

        function getRegionBadge(region) {
            return `<span class="region-badge region-${region}">${region}</span>`;
        }

        function getZhongheRatioClass(ratio) {
            const numRatio = parseFloat(ratio.replace('%', ''));
            if (numRatio >= 80) return 'ratio-high';
            if (numRatio >= 50) return 'ratio-medium';
            return 'ratio-low';
        }

        function getSelfDeclaredRateClass(rate) {
            const numRate = parseFloat(rate.replace('%', ''));
            if (numRate >= 80) return 'rate-excellent';
            if (numRate >= 50) return 'rate-good';
            return 'rate-poor';
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        // 根據組別判定業績積分是否達標：A>=25000, B>=35000, C>=45000
        function isAmountQualifiedForStore(store) {
            const group = (store.group || '').toString().toUpperCase();
            const thresholds = { 'A': 25000, 'B': 35000, 'C': 45000 };
            const threshold = thresholds[group] || 0;
            const score = Number(store.amountScore) || 0;
            return score >= threshold;
        }

        // 判定任意 score 是否達到該店組別門檻
        function isScoreQualifiedForStore(store, score) {
            const group = (store.group || '').toString().toUpperCase();
            const thresholds = { 'A': 25000, 'B': 35000, 'C': 45000 };
            const threshold = thresholds[group] || 0;
            const s = Number(score) || 0;
            return s >= threshold;
        }

        // 計算每家門市的平均積分並回傳標準競賽排名（同分同名次，下一名次數量減少）
        // 輸入 data 為該組的 store 陣列，回傳物件 map: { storeName: rank }
        function computeAvgRankMap(data) {
            // 建立包含 avg 的暫存陣列
            const arr = data.map(s => {
                const aug = getAugustScore(s.storeName);
                const sept = s.amountScore || 0;
                const avg = (typeof aug === 'number') ? Math.round((aug + sept) / 2) : sept;
                return { storeName: s.storeName, avg };
            });

            // 依 avg 降序排列（分數大排前）
            arr.sort((a, b) => b.avg - a.avg);

            const rankMap = {};
            for (let i = 0; i < arr.length; i++) {
                if (i > 0 && arr[i].avg === arr[i - 1].avg) {
                    // 同分同名次
                    rankMap[arr[i].storeName] = rankMap[arr[i - 1].storeName];
                } else {
                    // 標準競賽排名：排名為索引+1（因此上方三人同列1，下一名為4）
                    rankMap[arr[i].storeName] = i + 1;
                }
            }
            return rankMap;
        }

        // 計算客戶數平均積分排名（同分同名次，下一名次數量減少）
        function computeCustomerAvgRankMap(data) {
            // 建立包含平均客戶數積分的暫存陣列
            const arr = data.map(s => {
                const avgScore = getAverageCustomerScore(s.storeName);
                return { storeName: s.storeName, avgScore };
            });

            // 依平均積分降序排列（分數大排前）
            arr.sort((a, b) => b.avgScore - a.avgScore);

            const rankMap = {};
            let currentRank = 1;
            let currentScore = arr[0]?.avgScore;
            let sameRankCount = 0;

            arr.forEach((item, index) => {
                if (item.avgScore === currentScore) {
                    rankMap[item.storeName] = currentRank;
                    sameRankCount++;
                } else {
                    currentRank += sameRankCount;
                    currentScore = item.avgScore;
                    sameRankCount = 1;
                    rankMap[item.storeName] = currentRank;
                }
            });

            return rankMap;
        }

        function switchMainTab(tab) {
            currentMainTab = tab;
            
            // 更新主導航狀態
            document.querySelectorAll('.main-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 切換內容區域
            document.querySelectorAll('#amount-content, #customer-content, #region-content, #statistics-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab + '-content').classList.add('active');
            
            // 切換子導航標籤組
            document.querySelectorAll('.tab-group').forEach(group => {
                group.classList.remove('active');
            });
            document.getElementById(tab + '-tabs').classList.add('active');
            
            // 重置子導航狀態
            if (tab === 'amount') {
                currentGroupTab = 'group-a';
                document.querySelectorAll('#amount-tabs .group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                document.querySelector('#amount-tabs .group-tab[onclick*="group-a"]').classList.add('active');
                
                // 顯示A組內容
                document.querySelectorAll('#amount-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('group-a').classList.add('active');
            } else if (tab === 'customer') {
                currentGroupTab = 'customer-ab';
                document.querySelectorAll('#customer-tabs .group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                document.querySelector('#customer-tabs .group-tab[onclick*="customer-ab"]').classList.add('active');
                
                // 顯示A+B組內容
                document.querySelectorAll('#customer-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('customer-ab').classList.add('active');
            } else if (tab === 'region') {
                currentGroupTab = 'region-營一';
                document.querySelectorAll('#region-tabs .group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                document.querySelector('#region-tabs .group-tab[onclick*="region-營一"]').classList.add('active');
                
                // 顯示營一內容
                document.querySelectorAll('#region-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('region-營一').classList.add('active');
                
            } else if (tab === 'statistics') {
                // 統計儀表版：渲染 KPI
                currentGroupTab = 'statistics';
                try { renderStatisticsDashboard(); } catch (e) { console.warn('renderStatisticsDashboard failed', e); }
            }
            
            // 載入對應數據
            loadTabContent();
        }

        function switchGroupTab(tab) {
            currentGroupTab = tab;
            
            // 更新當前活動標籤組內的標籤狀態
            const activeTabGroup = document.querySelector('.tab-group.active');
            if (activeTabGroup) {
                activeTabGroup.querySelectorAll('.group-tab').forEach(groupTab => {
                    groupTab.classList.remove('active');
                });
                event.target.classList.add('active');
            }
            
            // 在各模式下切換子內容
            if (currentMainTab === 'amount') {
                document.querySelectorAll('#amount-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            } else if (currentMainTab === 'customer') {
                document.querySelectorAll('#customer-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            } else if (currentMainTab === 'region') {
                document.querySelectorAll('#region-content .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            }
            
            // 載入對應數據
            loadTabContent();
        }

        function loadTabContent() {
            // 設定初始排序狀態，並清除所有排序標記
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            if (currentMainTab === 'amount') {
                if (currentGroupTab.startsWith('group-')) {
                    const group = currentGroupTab.replace('group-', '').toUpperCase();
                    // 篩選出該組的資料
                    const groupData = competitionData.filter(store => store.group === group);
                    
                    // 設置初始排序為平均積分排名（降序）
                    currentSort = { field: 'avgRank', direction: 'desc' };
                    // 找到對應的表頭並添加排序標記
                    const header = document.querySelector(`#${currentGroupTab} th[data-field="avgRank"]`);
                    if (header) header.classList.add('sort-desc');
                    
                    // 按平均積分排序並顯示
                    sortTable('avgRank', header);
                }
            } else if (currentMainTab === 'customer') {
                if (currentGroupTab === 'customer-ab') {
                    // 篩選A+B組數據
                    const abGroupData = competitionData.filter(store => store.group === 'A' || store.group === 'B');
                    
                    // 設置初始排序為平均客戶數排名（降序）
                    currentSort = { field: 'customerAvgRank', direction: 'desc' };
                    // 找到對應的表頭並添加排序標記
                    const header = document.querySelector('#customer-ab th[data-field="customerAvgRank"]');
                    if (header) header.classList.add('sort-desc');
                    
                    // 按客戶數平均排名排序並顯示
                    sortTable('customerAvgRank', header);
                } else if (currentGroupTab === 'customer-c') {
                    // 篩選C組數據
                    const cGroupData = competitionData.filter(store => store.group === 'C');
                    
                    // 設置初始排序為平均客戶數排名（降序）
                    currentSort = { field: 'customerAvgRank', direction: 'desc' };
                    // 找到對應的表頭並添加排序標記
                    const header = document.querySelector('#customer-c th[data-field="customerAvgRank"]');
                    if (header) header.classList.add('sort-desc');
                    
                    // 按客戶數平均排名排序並顯示
                    sortTable('customerAvgRank', header);
                }
            } else if (currentMainTab === 'region') {
                if (currentGroupTab.startsWith('region-')) {
                    const region = currentGroupTab.replace('region-', '');
                    // 篩選出該區域的資料
                    const regionData = competitionData.filter(store => store.region === region);
                    
                    // 設置初始排序為門市名稱
                    currentSort = { field: 'storeName', direction: 'asc' };
                    // 找到對應的表頭並添加排序標記
                    const header = document.querySelector(`#${currentGroupTab} th[data-field="storeName"]`);
                    if (header) header.classList.add('sort-asc');
                    
                    populateRegionTableWithData(region, regionData);
                }
            }
        }

        function populateGroupTable(group) {
            const groupData = competitionData.filter(store => store.group === group);
            
            // 計算平均積分並排序
            const avgScores = new Map();
            groupData.forEach(store => {
                const augScore = getAugustScore(store.storeName);
                const septScore = store.amountScore || 0;
                const avgScore = (typeof augScore === 'number') ? 
                    Math.round((augScore + septScore) / 2) : 
                    septScore;
                avgScores.set(store.storeName, avgScore);
            });
            
            // 依平均積分由高到低排序
            if (!currentSort.field || currentSort.field === 'avgRank') {
                groupData.sort((a, b) => {
                    const aScore = avgScores.get(a.storeName);
                    const bScore = avgScores.get(b.storeName);
                    return currentSort.direction === 'asc' ? aScore - bScore : bScore - aScore;
                });
            } else {
                groupData.sort((a, b) => {
                    let aValue, bValue;
                    
                    switch (currentSort.field) {
                        case '客戶數排名':
                            aValue = (typeof getAugustCustomerScore(a.storeName) === 'number') ? 
                                Math.round((getAugustCustomerScore(a.storeName) + (a.customerScore || 0)) / 2) : 
                                (a.customerScore || 0);
                            bValue = (typeof getAugustCustomerScore(b.storeName) === 'number') ? 
                                Math.round((getAugustCustomerScore(b.storeName) + (b.customerScore || 0)) / 2) : 
                                (b.customerScore || 0);
                            break;
                        default:
                            aValue = a[currentSort.field] || 0;
                            bValue = b[currentSort.field] || 0;
                    }
                    
                    return currentSort.direction === 'desc' ? bValue - aValue : aValue - bValue;
                });
            }
            
            populateGroupTableWithData(group, groupData);
        }

        function populateCustomerABTable() {
            // 篩選A+B組數據
            const abGroupData = competitionData.filter(store => store.group === 'A' || store.group === 'B');
            populateCustomerABTableWithData(abGroupData);
        }

        function populateCustomerCTable() {
            // 篩選C組數據
            const cGroupData = competitionData.filter(store => store.group === 'C');
            populateCustomerCTableWithData(cGroupData);
        }
        // 已合併至 populateRegionTableWithData，避免重複定義

        function populateRegionTableWithData(region, data) {
            const tbody = document.getElementById(`region-${region}-table`);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 計算需要加總的欄位
            let totalOriginalAmount = 0;
            let totalNewAmount = 0;
            let totalOldAmount = 0;
            let totalNewCustomers = 0;
            let totalOldCustomers = 0;
            let totalAugustOriginalRevenue = 0;
            let totalSeptOriginalRevenue = 0;
            
            // 計算該 data 的平均排名映射（用於排序後的顯示）
            const rankMap = computeAvgRankMap(data);

            data.forEach((store) => {
                const isAmountQualified = isAmountQualifiedForStore(store);
                const isCustomerQualified = isCustomerQualifiedForStore(store, store.customerScore);
                const hasNoPerformance = store.amountScore === 0;
                
                // 計算積分相關變量
                const augScore = getAugustScore(store.storeName);
                const augThreshold = store.amountThreshold || store.自我宣告目標 || 0;
                const isAugQualified = (typeof augScore === 'number' && augScore >= augThreshold);
                const augDisplay = (typeof augScore === 'number') ? formatNumber(augScore) : '-';

                const septScore = store.amountScore;
                const isSeptQualified = isAmountQualified;
                const septDisplay = hasNoPerformance ? '<span class="performance-status">尚無積分</span>' : formatNumber(septScore);

                const avgAmountScore = (typeof augScore === 'number') ? Math.round(((augScore || 0) + (septScore || 0)) / 2) : septScore;
                const avgDisplay = typeof avgAmountScore === 'number' ? formatNumber(avgAmountScore) : '-';
                const isAvgQualified = isScoreQualifiedForStore(store, avgAmountScore);

                // 計算客戶數相關變量
                const augCustomerScore = getAugustCustomerScore(store.storeName);
                const septCustomerScore = store.customerScore;
                const avgCustomerScore = getAverageCustomerScore(store.storeName);
                
                // 計算原始業績
                const augustOriginalRevenue = getAugustOriginalRevenue(store.storeName);
                const septOriginalRevenue = getSeptOriginalRevenue(store.storeName);
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                // 累加總計
                const originalAmount = store.新客業績 + store.舊客業績;
                totalOriginalAmount += originalAmount;
                totalNewAmount += store.新客業績;
                totalOldAmount += store.舊客業績;
                totalNewCustomers += store.新客數;
                totalOldCustomers += store.舊客數;
                totalAugustOriginalRevenue += augustOriginalRevenue;
                totalSeptOriginalRevenue += septOriginalRevenue;

                row.innerHTML = `
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td class="number-cell ${isAugQualified ? 'qualified' : ''}">${augDisplay}</td>
                    <td class="number-cell ${isSeptQualified ? 'qualified' : ''}">${septDisplay}</td>
                    <td class="number-cell ${isAvgQualified ? 'qualified' : ''}">${avgDisplay}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, augCustomerScore) ? 'qualified' : ''}">${augCustomerScore || '-'}</td>
                    <td class="number-cell ${isCustomerQualified ? 'qualified' : ''}">${septCustomerScore}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, avgCustomerScore) ? 'qualified' : ''}">${avgCustomerScore || '0'}</td>
                    <td class="number-cell">${formatNumber(augustOriginalRevenue)}</td>
                    <td class="number-cell">${formatNumber(septOriginalRevenue)}</td>
                    <td class="number-cell">${formatNumber(store.自我宣告目標)}</td>
                    <td class="number-cell">
                        <span class="self-declared-rate ${getSelfDeclaredRateClass(store.自我宣告達成率)}">${store.自我宣告達成率}</span>
                    </td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
            // 添加總計列
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td class="store-name">總計 (${data.length}家)</td>
                <td>-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">${formatNumber(totalAugustOriginalRevenue)}</td>
                <td class="number-cell">${formatNumber(totalSeptOriginalRevenue)}</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
            `;
            tbody.appendChild(totalRow);
            
            // 添加平均列
            const avgRow = document.createElement('tr');
            avgRow.className = 'average-row';
            const avgAugustOriginalRevenue = data.length > 0 ? Math.round(totalAugustOriginalRevenue / data.length) : 0;
            const avgSeptOriginalRevenue = data.length > 0 ? Math.round(totalSeptOriginalRevenue / data.length) : 0;
            avgRow.innerHTML = `
                <td class="store-name">平均</td>
                <td>-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">${formatNumber(avgAugustOriginalRevenue)}</td>
                <td class="number-cell">${formatNumber(avgSeptOriginalRevenue)}</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
                <td class="number-cell">-</td>
            `;
            tbody.appendChild(avgRow);
        }

        // 初始化排序功能
        function initializeSorting() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('sortable')) {
                    const field = e.target.getAttribute('data-field');
                    sortTable(field, e.target);
                }
            });
        }

        // 排序表格
        function sortTable(field, headerElement) {
            // 更新排序方向
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.direction = 'asc';
                currentSort.field = field;
            }

            // 更新表頭樣式
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            headerElement.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');

            // 獲取當前顯示的數據
            let currentData = [];
            if (currentMainTab === 'amount') {
                const group = currentGroupTab.replace('group-', '').toUpperCase();
                currentData = competitionData.filter(store => store.group === group);
            } else if (currentMainTab === 'customer') {
                if (currentGroupTab === 'customer-ab') {
                    currentData = competitionData.filter(store => store.group === 'A' || store.group === 'B');
                } else if (currentGroupTab === 'customer-c') {
                    currentData = competitionData.filter(store => store.group === 'C');
                }
            } else if (currentMainTab === 'region') {
                const region = currentGroupTab.replace('region-', '');
                currentData = competitionData.filter(store => store.region === region);
            }

            // 排序數據
            currentData.sort((a, b) => {
                let valueA, valueB;

                switch(field) {
                    case 'storeName':
                        valueA = a.storeName;
                        valueB = b.storeName;
                        break;
                    case 'region':
                        valueA = a.region;
                        valueB = b.region;
                        break;
                    case 'amountScore':
                        valueA = a.amountScore;
                        valueB = b.amountScore;
                        break;
                    case 'group':
                        valueA = a.group;
                        valueB = b.group;
                        break;
                    case 'customerScore':
                        valueA = a.customerScore;
                        valueB = b.customerScore;
                        break;
                    case 'augustCustomerScore':
                        // 使用 augustCompetitionData 提供的客戶數積分進行排序
                        valueA = (typeof getAugustCustomerScore === 'function') ? (getAugustCustomerScore(a.storeName) || 0) : (a.augustCustomerScore || 0);
                        valueB = (typeof getAugustCustomerScore === 'function') ? (getAugustCustomerScore(b.storeName) || 0) : (b.augustCustomerScore || 0);
                        break;
                    case 'averageCustomerScore':
                        // 使用平均客戶數積分進行排序
                        valueA = getAverageCustomerScore(a.storeName);
                        valueB = getAverageCustomerScore(b.storeName);
                        break;
                    case 'avgRank':
                        // 使用 computeAvgRankMap 來獲取平均積分排名
                        const amountRankMap = computeAvgRankMap(currentData);
                        valueA = amountRankMap[a.storeName] || 0;
                        valueB = amountRankMap[b.storeName] || 0;
                        break;
                    case '客戶數排名':
                        valueA = a.客戶數排名;
                        valueB = b.客戶數排名;
                        break;
                    case '原始業績':
                        valueA = a.新客業績 + a.舊客業績;
                        valueB = b.新客業績 + b.舊客業績;
                        break;
                    case 'august原始業績':
                        valueA = getAugustOriginalRevenue(a.storeName);
                        valueB = getAugustOriginalRevenue(b.storeName);
                        break;
                    case 'sept原始業績':
                        valueA = getSeptOriginalRevenue(a.storeName);
                        valueB = getSeptOriginalRevenue(b.storeName);
                        break;
                    case '新客業績':
                        valueA = a.新客業績;
                        valueB = b.新客業績;
                        break;
                    case '自我宣告目標':
                        valueA = a.自我宣告目標;
                        valueB = b.自我宣告目標;
                        break;
                    case '自我宣告達成率':
                        valueA = parseFloat(a.自我宣告達成率.replace('%', ''));
                        valueB = parseFloat(b.自我宣告達成率.replace('%', ''));
                        break;
                    case 'customerAvgRank':
                        // 使用平均客戶數積分排名
                        const customerRankMap = computeCustomerAvgRankMap(currentData);
                        valueA = customerRankMap[a.storeName] || Number.MAX_VALUE;
                        valueB = customerRankMap[b.storeName] || Number.MAX_VALUE;
                        break;
                    case '舊客業績':
                        valueA = a.舊客業績;
                        valueB = b.舊客業績;
                        break;
                    case '新客數':
                        valueA = a.新客數;
                        valueB = b.新客數;
                        break;
                    case '舊客數':
                        valueA = a.舊客數;
                        valueB = b.舊客數;
                        break;
                    case '中和比例':
                        valueA = parseFloat(a.中和比例.replace('%', ''));
                        valueB = parseFloat(b.中和比例.replace('%', ''));
                        break;
                    case 'augustScore':
                        // 直接獲取8月份的金額積分
                        const augustStoreA = augustCompetitionData.find(store => store.storeName === a.storeName);
                        const augustStoreB = augustCompetitionData.find(store => store.storeName === b.storeName);
                        valueA = augustStoreA ? augustStoreA.amountScore : -1;
                        valueB = augustStoreB ? augustStoreB.amountScore : -1;
                        break;
                    case 'avgScore':
                        // 平均：若有8月數據則取(8月 + 9月)/2，否則只用9月
                        const aAug = typeof augustCompetitionData !== 'undefined' ? getAugustScore(a.storeName) : null;
                        const bAug = typeof augustCompetitionData !== 'undefined' ? getAugustScore(b.storeName) : null;
                        const aSept = a.amountScore || 0;
                        const bSept = b.amountScore || 0;
                        valueA = (typeof aAug === 'number') ? Math.round((aAug + aSept) / 2) : aSept;
                        valueB = (typeof bAug === 'number') ? Math.round((bAug + bSept) / 2) : bSept;
                        break;
                    default:
                        return 0;
                }

                // 比較邏輯
                if (typeof valueA === 'string') {
                    return currentSort.direction === 'asc' 
                        ? valueA.localeCompare(valueB)
                        : valueB.localeCompare(valueA);
                } else {
                    return currentSort.direction === 'asc' 
                        ? valueA - valueB
                        : valueB - valueA;
                }
            });

            // 重新填充表格
            if (currentMainTab === 'amount') {
                const group = currentGroupTab.replace('group-', '').toUpperCase();
                populateGroupTableWithData(group, currentData);
            } else if (currentMainTab === 'customer') {
                if (currentGroupTab === 'customer-ab') {
                    populateCustomerABTableWithData(currentData);
                } else if (currentGroupTab === 'customer-c') {
                    populateCustomerCTableWithData(currentData);
                }
            } else if (currentMainTab === 'region') {
                const region = currentGroupTab.replace('region-', '');
                populateRegionTableWithData(region, currentData);
            }

            // 更新排序資訊
            updateSortInfo(field);
        }

        // 使用指定數據填充組別表格
        function populateGroupTableWithData(group, data) {
            const tbody = document.getElementById(`group-${group.toLowerCase()}-table`);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 總是計算平均積分排名映射
            const avgRankMap = computeAvgRankMap(data);
            const customerRankMap = currentSort.field === '客戶數排名' ? computeCustomerAvgRankMap(data) : null;
            
            data.forEach((store) => {
                const isAmountQualified = isAmountQualifiedForStore(store);
                const hasNoPerformance = store.amountScore === 0;
                
                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';
                
                const row = document.createElement('tr');
                row.className = rowClass;
                
                // 根據當前排序欄位顯示對應的排名
                let rankDisplay;
                if (currentSort.field === '客戶數排名') {
                    rankDisplay = customerRankMap ? customerRankMap[store.storeName] : store.客戶數排名;
                } else {
                    // 預設顯示平均積分排名
                    const avgRank = avgRankMap[store.storeName];
                    rankDisplay = avgRank;
                }
                
                // 計算八月和九月的積分
                const augScore = getAugustScore(store.storeName);
                const augThreshold = store.amountThreshold || store.自我宣告目標 || 0;
                const isAugQualified = (typeof augScore === 'number' && augScore >= augThreshold);
                const augDisplay = (typeof augScore === 'number') ? formatNumber(augScore) : '-';

                const septScore = store.amountScore;
                const isSeptQualified = isAmountQualified;
                const septDisplay = hasNoPerformance ? '<span class="performance-status">尚無積分</span>' : formatNumber(septScore);

                // 計算平均積分
                const avgScore = (typeof augScore === 'number') ? Math.round(((augScore || 0) + (septScore || 0)) / 2) : septScore;
                const avgDisplay = typeof avgScore === 'number' ? formatNumber(avgScore) : '-';
                const isAvgQualified = isScoreQualifiedForStore(store, avgScore);

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isAugQualified ? 'qualified' : ''}">${augDisplay}</td>
                    <td class="number-cell ${isSeptQualified ? 'qualified' : ''}">${septDisplay}</td>
                    <td class="number-cell ${isAvgQualified ? 'qualified' : ''}">${avgDisplay}</td>
                    <td class="number-cell">${formatNumber(store.自我宣告目標)}</td>
                    <td class="number-cell">
                        <span class="self-declared-rate ${getSelfDeclaredRateClass(store.自我宣告達成率)}">${store.自我宣告達成率}</span>
                    </td>
                    <td class="number-cell">${formatNumber(store.新客業績)}</td>
                    <td class="number-cell">${formatNumber(store.舊客業績)}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 使用指定數據填充客戶A+B表格
        function populateCustomerABTableWithData(data) {
            const tbody = document.getElementById('customer-ab-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 計算平均客戶數積分排名
            const customerAvgRankMap = computeCustomerAvgRankMap(data);
            
            // 初始化總計
            let totalNewCustomers = 0;
            let totalOldCustomers = 0;
            
            data.forEach((store, index) => {
                const hasNoPerformance = store.customerScore === 0;
                // 累加總計
                totalNewCustomers += Number(store.新客數) || 0;
                totalOldCustomers += Number(store.舊客數) || 0;

                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';

                const row = document.createElement('tr');
                row.className = rowClass;

                // 顯示平均客戶數排名
                const rankDisplay = customerAvgRankMap[store.storeName] || store.客戶數排名;

                // 獲取各個階段的積分，並分別判斷是否達標
                const augScore = getAugustCustomerScore(store.storeName);
                const septScore = store.customerScore;
                const avgScore = getAverageCustomerScore(store.storeName);

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, augScore) ? 'qualified' : ''}">${augScore || '-'}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, septScore) ? 'qualified' : ''}">${septScore || '0'}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, avgScore) ? 'qualified' : ''}">${avgScore || '0'}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 使用指定數據填充客戶C組表格
        function populateCustomerCTableWithData(data) {
            const tbody = document.getElementById('customer-c-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 計算平均客戶數積分排名
            const customerAvgRankMap = computeCustomerAvgRankMap(data);
            
            // 初始化總計
            let totalNewCustomers = 0;
            let totalOldCustomers = 0;
            
            data.forEach((store, index) => {
                const hasNoPerformance = store.customerScore === 0;
                // 累加總計
                totalNewCustomers += Number(store.新客數) || 0;
                totalOldCustomers += Number(store.舊客數) || 0;

                let rowClass = `group-${store.group.toLowerCase()}`;
                if (hasNoPerformance) rowClass += ' no-performance';

                const row = document.createElement('tr');
                row.className = rowClass;

                // 顯示平均客戶數排名
                const rankDisplay = customerAvgRankMap[store.storeName] || store.客戶數排名;

                // 獲取各個階段的積分，並分別判斷是否達標
                const augScore = getAugustCustomerScore(store.storeName);
                const septScore = store.customerScore;
                const avgScore = getAverageCustomerScore(store.storeName);

                row.innerHTML = `
                    <td class="number-cell">${rankDisplay}</td>
                    <td class="store-name">${store.storeName}</td>
                    <td>${getGroupBadge(store.group)}</td>
                    <td>${getRegionBadge(store.region)}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, augScore) ? 'qualified' : ''}">${augScore || '-'}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, septScore) ? 'qualified' : ''}">${septScore || '0'}</td>
                    <td class="number-cell ${isCustomerQualifiedForStore(store, avgScore) ? 'qualified' : ''}">${avgScore || '0'}</td>
                    <td class="number-cell">${store.新客數}</td>
                    <td class="number-cell">${store.舊客數}</td>
                    <td class="number-cell"><span class="zhonghe-ratio ${getZhongheRatioClass(store.中和比例)}">${store.中和比例}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 更新排序資訊
        function updateSortInfo(field) {
            const fieldNames = {
                'storeName': '門市名稱',
                'region': '區域',
                'group': '組別',
                'amountScore': '9月金額積分',
                'augustScore': '8月金額積分',
                'avgScore': '平均金額積分',
                'avgRank': '平均積分排名',
                'customerScore': '9月客戶數積分',
                'augustCustomerScore': '8月客戶數積分',
                'august原始業績': '8月原始業績',
                'sept原始業績': '9月原始業績',
                '新客業績': '新客業績',
                '舊客業績': '舊客業績',
                '自我宣告目標': '自我宣告目標',
                '自我宣告達成率': '自我宣告達成率',
                '新客數': '新客數',
                '舊客數': '舊客數',
                '中和比例': '中和發包比例',
                '客戶數排名': '客戶數排名',
                '原始業績': '原始業績'
            };
            
            const direction = currentSort.direction === 'asc' ? '升序' : '降序';
            const sortInfo = document.getElementById(`sort-info-${currentGroupTab}`);
            
            if (sortInfo) {
                sortInfo.textContent = `目前排序：依${fieldNames[field]} (${direction})`;
            }
        }

        // 更新組別統計資訊
        function updateGroupStats() {
            // 計算各組的金額積分總和
            const groups = ['A', 'B', 'C'];
            groups.forEach(group => {
                const groupData = competitionData.filter(store => store.group === group);
                const totalAmount = groupData.reduce((sum, store) => sum + store.amountScore, 0);
                // 更新組別標籤中的金額總和
                const amountElement = document.getElementById(`group-${group.toLowerCase()}-amount`);
                if (amountElement) {
                    amountElement.textContent = formatNumber(totalAmount);
                }
                // 隱藏原有的統計區塊
                const statsElement = document.getElementById(`group-${group.toLowerCase()}-stats`);
                if (statsElement) {
                    statsElement.style.display = 'none';
                }
            });
        }

        // 更新統計資訊
        function updateStatisticsInfo() {
            const totalAmount = document.getElementById('total-amount');
            const growthRate = document.getElementById('growth-rate');
            
            if (totalAmount && growthRate && window.competitionStatistics) {
                totalAmount.textContent = formatNumber(window.competitionStatistics.原始總業績加總);
                const growth = ((window.competitionStatistics.原始總業績加總 - 300909) / 300909 * 100).toFixed(1);
                growthRate.textContent = `${growth}%`;
                growthRate.parentElement.classList.add(growth >= 0 ? 'positive' : 'negative');
            }
        }

        // 獲取8月份的資料 (安全取用，若找不到回傳 null)
        function getAugustData(storeName) {
            if (typeof augustCompetitionData === 'undefined') {
                // augustCompetitionData 可能尚未載入
                console.warn('augustCompetitionData is undefined');
                return null;
            }
            if (!Array.isArray(augustCompetitionData)) {
                console.warn('augustCompetitionData is not an array:', augustCompetitionData);
                return null;
            }
            return augustCompetitionData.find(s => s.storeName === storeName) || null;
        }

        // 獲取8月份的金額積分（若不存在回傳 null）
        function getAugustScore(storeName) {
            const store = getAugustData(storeName);
            if (!store) return null;
            return typeof store.amountScore !== 'undefined' ? Number(store.amountScore) : null;
        }

        // 獲取8月份的客戶數積分（若不存在回傳 null）
        function getAugustCustomerScore(storeName) {
            const store = getAugustData(storeName);
            if (!store) return null;
            return typeof store.customerScore !== 'undefined' ? Number(store.customerScore) : null;
        }

        // 計算8月和9月的平均客戶數積分
        function getAverageCustomerScore(storeName) {
            const augustScore = getAugustCustomerScore(storeName);
            const septStore = competitionData.find(s => s.storeName === storeName);
            const septemberScore = septStore ? Number(septStore.customerScore) : null;
            
            // 如果兩個月都沒有分數，回傳0
            if ((augustScore === null || augustScore === undefined) && 
                (septemberScore === null || septemberScore === undefined)) {
                return 0;
            }
            
            // 如果其中一個月沒有分數，回傳另一個月的分數
            if (augustScore === null || augustScore === undefined) return septemberScore || 0;
            if (septemberScore === null || septemberScore === undefined) return augustScore || 0;
            
            // 兩個月都有分數，計算平均值
            return Math.round((augustScore + septemberScore) / 2);
        }

        // 獲取8月份的原始業績（新客業績 + 舊客業績）
        function getAugustOriginalRevenue(storeName) {
            const store = getAugustData(storeName);
            if (!store) return 0;
            const newCustomer = Number(store.新客業績) || 0;
            const oldCustomer = Number(store.舊客業績) || 0;
            return newCustomer + oldCustomer;
        }

        // 獲取9月份的原始業績（新客業績 + 舊客業績）
        function getSeptOriginalRevenue(storeName) {
            const store = competitionData.find(s => s.storeName === storeName);
            if (!store) return 0;
            const newCustomer = Number(store.新客業績) || 0;
            const oldCustomer = Number(store.舊客業績) || 0;
            return newCustomer + oldCustomer;
        }

        // 渲染統計儀表版 KPI
        function renderStatisticsDashboard() {
            if (typeof competitionData === 'undefined' || typeof augustCompetitionData === 'undefined') return;
            const allStores = competitionData;
            const storeCount = allStores.length;
            // 合計
            let augSum = 0, septSum = 0;
            let augNewCount = 0, augOldCount = 0;
            let septNewCount = 0, septOldCount = 0;
            let augNewRev = 0, augOldRev = 0;
            let septNewRev = 0, septOldRev = 0;
            allStores.forEach(s => {
                // 9月資料
                const sept = competitionData.find(x => x.storeName === s.storeName) || {};
                const septNew = Number(sept.新客數) || 0;
                const septOld = Number(sept.舊客數) || 0;
                const septNewAmt = Number(sept.新客業績) || 0;
                const septOldAmt = Number(sept.舊客業績) || 0;
                septNewCount += septNew;
                septOldCount += septOld;
                septNewRev += septNewAmt;
                septOldRev += septOldAmt;
                // 8月資料
                const aug = getAugustData(s.storeName) || {};
                const augNew = Number(aug.新客數) || 0;
                const augOld = Number(aug.舊客數) || 0;
                const augNewAmt = Number(aug.新客業績) || 0;
                const augOldAmt = Number(aug.舊客業績) || 0;
                augNewCount += augNew;
                augOldCount += augOld;
                augNewRev += augNewAmt;
                augOldRev += augOldAmt;
                // 原始業績總和
                augSum += (augNewAmt + augOldAmt);
                septSum += (septNewAmt + septOldAmt);
            });
            const augAvg = storeCount ? Math.round(augSum / storeCount) : 0;
            const septAvg = storeCount ? Math.round(septSum / storeCount) : 0;
            // 客單價（ARPU）
            const augNewArpu = augNewCount ? Math.round(augNewRev / augNewCount) : 0;
            const augOldArpu = augOldCount ? Math.round(augOldRev / augOldCount) : 0;
            const septNewArpu = septNewCount ? Math.round(septNewRev / septNewCount) : 0;
            const septOldArpu = septOldCount ? Math.round(septOldRev / septOldCount) : 0;
            const baseline = 300909;
            const augAch = baseline ? ((augSum / baseline) * 100).toFixed(1) : '0.0';
            const septAch = baseline ? ((septSum / baseline) * 100).toFixed(1) : '0.0';

            // 寫入 DOM
            const byId = id => document.getElementById(id);
            const setText = (id, val) => { const el = byId(id); if (el) el.textContent = typeof val === 'number' ? val.toLocaleString() : val; };
            setText('kpi-store-count', storeCount);
            setText('kpi-aug-sum', augSum);
            setText('kpi-aug-avg', augAvg);
            setText('kpi-sept-sum', septSum);
            setText('kpi-sept-avg', septAvg);
            setText('kpi-aug-achievement-rate', `${augAch}%`);
            setText('kpi-sept-achievement-rate', `${septAch}%`);
            // 新客/舊客 數量（合計）
            setText('kpi-aug-new-count', augNewCount);
            setText('kpi-aug-old-count', augOldCount);
            setText('kpi-sept-new-count', septNewCount);
            setText('kpi-sept-old-count', septOldCount);
            // 新客/舊客 原始業績（合計）
            setText('kpi-aug-new-rev', augNewRev);
            setText('kpi-aug-old-rev', augOldRev);
            setText('kpi-sept-new-rev', septNewRev);
            setText('kpi-sept-old-rev', septOldRev);
            // 客單價（8月）
            setText('kpi-aug-new-arpu', augNewArpu);
            setText('kpi-aug-old-arpu', augOldArpu);
            // 客單價（9月）
            setText('kpi-sept-new-arpu', septNewArpu);
            setText('kpi-sept-old-arpu', septOldArpu);
        }
        // 客戶數積分門檻判斷：A/B組為60，C組為30
        function isCustomerQualifiedForStore(store, score) {
            const group = (store.group || '').toString().toUpperCase();
            const threshold = (group === 'C') ? 30 : 60;
            const s = (typeof score === 'number') ? score : Number(score) || 0;
            return s >= threshold;
        }
        // 初始化頁面（在 DOMContentLoaded 後執行）
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ready — initializing page');

            // 基本檢查：確保資料檔已由<script>載入
            const missing = [];
            if (typeof competitionData === 'undefined') missing.push('competition-data.js');
            if (typeof augustCompetitionData === 'undefined') missing.push('competition-data-aug.js');

            if (missing.length) {
                console.error('Missing data files:', missing.join(', '));
                document.querySelector('.container').innerHTML = `
                    <div style="padding: 50px; text-align: center; color: #e74c3c;">
                        <h2>❌ 數據載入失敗</h2>
                        <p>缺少下列資料檔：${missing.join(', ')}</p>
                        <p>請確認這些檔案與 HTML 位於同一目錄，並正確載入。</p>
                    </div>
                `;
                return;
            }

            // 一切正常：載入初始畫面與功能
            try {
                loadTabContent();
                initializeSorting();
                updateStatisticsInfo();
                updateGroupStats();
            } catch (err) {
                console.error('Error during initialization:', err);
                document.querySelector('.container').innerHTML = `
                    <div style="padding: 50px; text-align: center; color: #e74c3c;">
                        <h2>❌ 初始化失敗</h2>
                        <pre style="text-align:left; max-width:800px; margin:0 auto;">${err}</pre>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
                    